<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Merge Alchemy: ABSOLUTE Hardcore</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            touch-action: none;
            overflow: hidden;
            background-color: #020617;
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: white;
        }
        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #game-board {
            position: relative;
            width: 95vw;
            max-width: 500px;
            height: 50vh;
            background: radial-gradient(circle, #0f172a 0%, #020617 100%);
            border: 2px solid #1e293b;
            border-radius: 24px;
            margin-top: 10px;
            overflow: hidden;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
        }
        .item {
            position: absolute;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: grab;
            user-select: none;
            z-index: 10;
            /* Transition only for auto-movements, removed during drag via JS */
            transition: left 0.3s ease-out, top 0.3s ease-out;
        }
        .item.dragging {
            transition: none !important;
            z-index: 100;
            transform: scale(1.1);
        }
        .xp-bar-container {
            width: 100%;
            height: 8px;
            background: #1e293b;
            border-radius: 10px;
        }
        .xp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #a855f7, #ec4899);
            width: 0%;
            transition: width 0.3s;
        }
        .panel {
            position: fixed;
            inset: 0;
            background: rgba(2, 6, 23, 0.98);
            z-index: 100;
            padding: 2rem;
            display: none;
            flex-direction: column;
        }
        .panel.active { display: flex; }
        .zone {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            opacity: 0.4;
            transition: all 0.2s;
        }
        .zone.active { opacity: 1; background: rgba(255,255,255,0.1); }
        
        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.6); transform: scale(1); }
            50% { box-shadow: 0 0 0 10px rgba(234, 179, 8, 0); transform: scale(1.05); }
            100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0); transform: scale(1); }
        }
        .emergency-active {
            animation: pulse-gold 1.5s infinite;
            border-color: #eab308 !important;
            background-color: #422006 !important;
        }
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 500;
        }
        .modal.active { display: flex; }

        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .toast {
            background: #10b981;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: bold;
            margin-bottom: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        @keyframes magic-sparkle {
            0% { filter: brightness(1) drop-shadow(0 0 0px #a855f7); }
            50% { filter: brightness(1.5) drop-shadow(0 0 15px #a855f7); }
            100% { filter: brightness(1) drop-shadow(0 0 0px #a855f7); }
        }
        .magic-active { animation: magic-sparkle 0.5s ease-in-out; }
    </style>
</head>
<body>

<div id="toast-container"></div>

<div class="game-container">
    <div class="w-full max-w-md px-4 pt-6 flex flex-col gap-1">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-[10px] text-slate-500 font-black uppercase tracking-widest">–ë–∞–ª–∞–Ω—Å</p>
                <div class="flex items-center gap-2">
                    <span class="text-3xl font-black text-yellow-500" id="coins">0</span>
                    <span class="text-sm text-slate-400">ü™ô</span>
                </div>
                <p class="text-[11px] text-green-400 font-bold" id="rub-convert">‚âà 0.00 —Ä—É–±.</p>
            </div>
            <div class="flex gap-1.5">
                <button onclick="confirmReset()" class="bg-red-900/40 border border-red-500/30 p-2 rounded-xl text-lg transition-all active:scale-90">üîÑ</button>
                <button id="add-coins-btn" onclick="getEmergencyGrant()" class="bg-slate-800 border border-slate-700 p-2 rounded-xl text-lg transition-all active:scale-90">‚ûï</button>
                <button onclick="useMagicWand()" id="wand-btn" class="bg-purple-900/40 border border-purple-500/30 p-2 rounded-xl text-lg transition-all active:scale-90">‚ú®</button>
                <button onclick="togglePanel('shop')" class="bg-yellow-900/30 border border-yellow-600/30 p-2 rounded-xl text-lg">üõí</button>
                <button onclick="togglePanel('storage')" class="bg-slate-800 p-2 border border-slate-700 rounded-xl">üì¶</button>
                <button onclick="togglePanel('withdraw')" class="bg-indigo-900/50 border border-indigo-500/30 p-2 rounded-xl">üí∏</button>
            </div>
        </div>
        
        <div class="xp-bar-container mt-4">
            <div id="xp-fill" class="xp-bar-fill"></div>
        </div>
        <div class="flex justify-between text-[9px] text-slate-500 font-black uppercase mt-1">
            <span id="lvl-txt" class="text-indigo-400">–£–†. 1</span>
            <span id="xp-txt">XP: 0/10000</span>
        </div>
    </div>

    <div id="game-board">
        <div class="absolute bottom-0 left-0 right-0 h-16 flex border-t border-white/5 pointer-events-none">
            <div id="sell-zone" class="zone text-red-500">–ü–†–û–î–ê–¢–¨ (15%) ‚ôªÔ∏è</div>
            <div id="storage-zone" class="zone text-blue-500">–°–ö–õ–ê–î üì¶</div>
        </div>
    </div>

    <div class="w-full max-w-md p-6 flex flex-col gap-3">
        <button id="spawn-btn" class="w-full bg-indigo-600 py-5 rounded-3xl font-black text-xl shadow-[0_4px_0_rgb(49,46,129)] active:translate-y-1 active:shadow-none transition-all uppercase">
            –ü–†–ò–ó–í–ê–¢–¨ x8 <span class="text-indigo-300 ml-2 text-sm" id="price-txt">5 ü™ô</span>
        </button>
        <div class="flex justify-around text-[10px] font-black text-slate-500 uppercase">
            <span id="stat-merges">–°–ª–∏—è–Ω–∏–π: 0</span>
            <span id="stat-discovered">–û—Ç–∫—Ä—ã—Ç–æ: 1/50</span>
        </div>
    </div>
</div>

<!-- –ü–∞–Ω–µ–ª–∏ -->
<div id="panel-shop" class="panel">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-2xl font-black text-yellow-500 uppercase">–ú–∞–≥–∞–∑–∏–Ω</h2>
        <button onclick="togglePanel('shop')" class="text-2xl p-2 bg-slate-800 rounded-full">‚úï</button>
    </div>
    <div id="shop-list" class="space-y-3 overflow-y-auto pr-2 pb-10"></div>
</div>

<div id="panel-storage" class="panel">
    <div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-black text-blue-400 uppercase">–°–∫–ª–∞–¥</h2><button onclick="togglePanel('storage')" class="text-2xl">‚úï</button></div>
    <div id="storage-grid" class="grid grid-cols-4 gap-3"></div>
</div>

<div id="panel-withdraw" class="panel">
    <div class="flex justify-between items-center mb-6"><h2 class="text-2xl font-black text-green-500 uppercase">–í—ã–≤–æ–¥</h2><button onclick="togglePanel('withdraw')" class="text-2xl">‚úï</button></div>
    <div class="bg-slate-900 p-6 rounded-3xl border border-slate-800 text-center">
        <p class="text-slate-400 text-sm mb-2 uppercase font-bold tracking-widest">–ë–∏—Ä–∂–∞ Alchemy</p>
        <div class="text-4xl font-black text-green-400 mb-6" id="wd-rub">0.00 ‚ÇΩ</div>
        <div class="space-y-3">
            <button id="withdraw-btn" onclick="handleWithdraw()" class="w-full bg-green-600 hover:bg-green-500 py-4 rounded-xl font-black uppercase shadow-[0_4px_0_rgb(22,101,52)] active:translate-y-1 active:shadow-none transition-all">–í—ã–≤–µ—Å—Ç–∏ –ø—Ä–∏–±—ã–ª—å</button>
            <p class="text-[10px] text-slate-500 uppercase">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥: 500.00 ‚ÇΩ (500,000 ü™ô)</p>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∏ -->
<div id="reset-modal" class="modal">
    <div class="bg-slate-900 p-6 rounded-3xl border border-slate-700 w-80 text-center">
        <h3 class="text-xl font-black mb-4 uppercase">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë?</h3>
        <p class="text-slate-400 text-sm mb-6">–í–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω –Ω–∞–≤—Å–µ–≥–¥–∞.</p>
        <div class="flex gap-2">
            <button onclick="closeResetModal()" class="flex-1 bg-slate-700 py-3 rounded-xl font-bold">–û–¢–ú–ï–ù–ê</button>
            <button onclick="resetGame()" class="flex-1 bg-red-600 py-3 rounded-xl font-bold">–°–ë–†–û–°</button>
        </div>
    </div>
</div>

<div id="discovery-modal" class="fixed inset-0 bg-black/95 z-[200] hidden flex items-center justify-center p-8 text-center">
    <div>
        <p class="text-indigo-400 font-black tracking-widest uppercase mb-2 animate-bounce">–ù–æ–≤–∞—è –º–∞—Ç–µ—Ä–∏—è!</p>
        <div id="new-emoji" class="text-9xl mb-4 drop-shadow-[0_0_30px_rgba(99,102,241,0.5)]"></div>
        <h2 id="new-name" class="text-3xl font-black mb-8 uppercase text-white"></h2>
        <button onclick="document.getElementById('discovery-modal').classList.add('hidden')" class="bg-white text-black px-12 py-4 rounded-full font-black uppercase">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
</div>

<script>
    const ITEM_TYPES = [
        { emoji: '‚òÅÔ∏è', name: '–ü–∞—Ä', buy: 5 }, { emoji: 'üíß', name: '–ö–∞–ø–ª—è', buy: 15 },
        { emoji: 'üåø', name: '–†–æ—Å—Ç–æ–∫', buy: 40 }, { emoji: 'üî•', name: '–ò—Å–∫—Ä–∞', buy: 120 },
        { emoji: 'üíé', name: '–û—Å–∫–æ–ª–æ–∫', buy: 350 }, { emoji: '‚ö°', name: '–ó–∞—Ä—è–¥', buy: 1000 },
        { emoji: 'üå™Ô∏è', name: '–í–∏—Ö—Ä—å', buy: 3000 }, { emoji: 'üåã', name: '–ú–∞–≥–º–∞', buy: 8000 },
        { emoji: 'üåÄ', name: '–≠—Ñ–∏—Ä', buy: 20000 }, { emoji: 'üß¨', name: '–ö–ª–µ—Ç–∫–∞', buy: 50000 }
    ];
    for(let i=10; i<50; i++) {
        ITEM_TYPES.push({ emoji: 'üí†', name: '–ú–∞—Ç–µ—Ä–∏—è ' + (i+1), buy: Math.floor(ITEM_TYPES[i-1].buy * 2.8) });
    }

    const SPAWN_AMOUNT = 512; 
    const XP_PER_MERGE = 5; 
    const WAND_COST = 0;

    let state = {
        coins: 5,
        xp: 0,
        level: 1,
        items: [],
        storage: [],
        discovered: [0],
        totalMerges: 0
    };

    let dragData = null;

    function init() {
        const saved = localStorage.getItem('hc_alchemy_absolute_v2');
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                state = { ...state, ...parsed };
            } catch(e) { console.error("Load error", e); }
        }
        
        renderBoard();
        updateUI();
        setInterval(save, 5000);
        
        document.getElementById('spawn-btn').onclick = () => spawn();

        document.addEventListener('mousemove', onMove);
        document.addEventListener('touchmove', onMove, {passive: false});
        document.addEventListener('mouseup', onEnd);
        document.addEventListener('touchend', onEnd);
    }

    function showToast(text) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = 'toast';
        toast.innerText = text;
        container.appendChild(toast);
        setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transform = 'translateX(100%)';
            setTimeout(() => toast.remove(), 300);
        }, 2000);
    }

    function useMagicWand() {
        const wandBtn = document.getElementById('wand-btn');
        if (state.coins < WAND_COST) {
            showToast('‚ùå –ú–∞–ª–æ –º–æ–Ω–µ—Ç –¥–ª—è –º–∞–≥–∏–∏ (1 ü™ô)');
            return;
        }

        const groups = {};
        state.items.forEach(it => {
            if (!groups[it.level]) groups[it.level] = [];
            groups[it.level].push(it);
        });

        let foundMerge = false;
        for (const level in groups) {
            const itemsInLvl = groups[level];
            while (itemsInLvl.length >= 2) {
                const i1 = itemsInLvl.pop();
                const i2 = itemsInLvl.pop();
                merge(i1, i2);
                foundMerge = true;
            }
        }

        if (foundMerge) {
            state.coins -= WAND_COST;
            wandBtn.classList.add('magic-active');
            setTimeout(() => wandBtn.classList.remove('magic-active'), 500);
            showToast('‚ú® –ú–∞–≥–∏—è —Å—Ä–∞–±–æ—Ç–∞–ª–∞! (-1 ü™ô)');
            updateUI();
        } else {
            showToast('–ù–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å');
        }
    }

    function handleWithdraw() {
        const btn = document.getElementById('withdraw-btn');
        if (state.coins < 500000) {
            btn.innerText = "–ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–†–ï–î–°–¢–í";
            setTimeout(() => btn.innerText = "–í—ã–≤–µ—Å—Ç–∏ –ø—Ä–∏–±—ã–ª—å", 1000);
        } else {
            alert('–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!');
        }
    }

    function confirmReset() { document.getElementById('reset-modal').classList.add('active'); }
    function closeResetModal() { document.getElementById('reset-modal').classList.remove('active'); }
    function resetGame() { localStorage.removeItem('hc_alchemy_absolute_v2'); window.location.reload(); }

    function getEmergencyGrant() {
        const cost = getSpawnCost();
        if (state.coins < cost) {
            state.coins += (cost * 8); 
            updateUI();
            showToast('–ì—Ä–∞–Ω—Ç –ø–æ–ª—É—á–µ–Ω! ü™ô');
        }
    }

    function getSpawnCost() { return Math.floor(5 * Math.pow(1.5, state.level - 1)); }
    function getLevelReq(lvl) { return 10000 * Math.pow(10, lvl - 1); }

    function spawn() {
        const cost = getSpawnCost();
        if (state.coins >= cost) {
            state.coins -= cost;
            for(let i=0; i<SPAWN_AMOUNT; i++) createItem(0);
            updateUI();
        } else {
            showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
        }
    }

    function buyFromShop(lvl, amount) {
        const it = ITEM_TYPES[lvl];
        const price = amount === 1 ? it.buy : Math.floor(it.buy * amount * 0.9);
        if (state.coins >= price) {
            state.coins -= price;
            for(let i=0; i<amount; i++) createItem(lvl);
            updateUI();
        }
    }

    function createItem(lvl, x, y) {
        const board = document.getElementById('game-board').getBoundingClientRect();
        const item = {
            id: 'i' + Math.random().toString(36).substr(2, 5),
            level: lvl,
            x: x ?? (Math.random() * (board.width - 60)),
            y: y ?? (Math.random() * (board.height - 120))
        };
        state.items.push(item);
        renderItem(item);
    }

    function renderItem(item) {
        const el = document.createElement('div');
        el.className = 'item';
        el.id = item.id;
        el.innerHTML = state.discovered.includes(item.level) ? ITEM_TYPES[item.level].emoji : '‚ùì';
        el.style.left = item.x + 'px';
        el.style.top = item.y + 'px';
        
        const start = (e) => {
            if (dragData) return;
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            const r = el.getBoundingClientRect();
            
            el.classList.add('dragging');
            dragData = { el, item, ox: cx - r.left, oy: cy - r.top };
        };
        
        el.onmousedown = start;
        el.ontouchstart = start;
        document.getElementById('game-board').appendChild(el);
    }

    function onMove(e) {
        if (!dragData) return;
        if(e.cancelable) e.preventDefault();
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        const board = document.getElementById('game-board').getBoundingClientRect();
        
        let nx = cx - board.left - dragData.ox;
        let ny = cy - board.top - dragData.oy;
        
        nx = Math.max(0, Math.min(nx, board.width - 60));
        ny = Math.max(0, Math.min(ny, board.height - 60));
        
        dragData.el.style.left = nx + 'px';
        dragData.el.style.top = ny + 'px';
        dragData.item.x = nx;
        dragData.item.y = ny;
        
        const isLow = ny > board.height - 80;
        document.getElementById('sell-zone').classList.toggle('active', isLow && nx < board.width/2);
        document.getElementById('storage-zone').classList.toggle('active', isLow && nx >= board.width/2);
    }

    function onEnd() {
        if (!dragData) return;
        const board = document.getElementById('game-board').getBoundingClientRect();
        const it = dragData.item;
        
        dragData.el.classList.remove('dragging');
        
        if (it.y > board.height - 80) {
            if (it.x < board.width / 2) {
                state.items = state.items.filter(i => i.id !== it.id);
                dragData.el.remove();
                let sellPrice = it.level === 0 ? 1 : Math.max(1, Math.floor(ITEM_TYPES[it.level].buy * 0.15));
                state.coins += sellPrice;
                showToast(`–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ${sellPrice} ü™ô`);
            } else {
                if (state.storage.length < 16) {
                    state.items = state.items.filter(i => i.id !== it.id);
                    dragData.el.remove();
                    state.storage.push(it.level);
                }
            }
        } else {
            const target = state.items.find(i => i.id !== it.id && i.level === it.level && Math.hypot(i.x - it.x, i.y - it.y) < 35);
            if (target) merge(it, target);
        }
        dragData = null;
        updateUI();
    }

    function merge(i1, i2) {
        const next = i1.level + 1;
        if (next >= ITEM_TYPES.length) return;
        state.items = state.items.filter(i => i.id !== i1.id && i.id !== i2.id);
        document.getElementById(i1.id)?.remove();
        document.getElementById(i2.id)?.remove();
        
        state.xp += XP_PER_MERGE; 
        state.totalMerges++;
        
        if (!state.discovered.includes(next)) {
            state.discovered.push(next);
            showDiscovery(next);
        }
        createItem(next, i2.x, i2.y);
        checkLvl();
    }

    function checkLvl() {
        const req = getLevelReq(state.level);
        if (state.xp >= req) {
            state.xp -= req;
            state.level++;
        }
    }

    function updateUI() {
        document.getElementById('coins').innerText = Math.floor(state.coins).toLocaleString();
        document.getElementById('rub-convert').innerText = `‚âà ${(state.coins / 1000).toFixed(2)} —Ä—É–±.`;
        document.getElementById('wd-rub').innerText = `${(state.coins / 1000).toFixed(2)} ‚ÇΩ`;
        document.getElementById('lvl-txt').innerText = `–£–†. ${state.level}`;
        document.getElementById('stat-merges').innerText = `–°–ª–∏—è–Ω–∏–π: ${state.totalMerges}`;
        document.getElementById('stat-discovered').innerText = `–û—Ç–∫—Ä—ã—Ç–æ: ${state.discovered.length}/50`;
        const req = getLevelReq(state.level);
        document.getElementById('xp-fill').style.width = (state.xp / req * 100) + '%';
        document.getElementById('xp-txt').innerText = `XP: ${Math.floor(state.xp).toLocaleString()} / ${Math.floor(req).toLocaleString()}`;
        document.getElementById('price-txt').innerText = `${getSpawnCost()} ü™ô`;
        
        const levelsOnBoard = state.items.map(i => i.level);
        const hasMergeAvailable = new Set(levelsOnBoard).size !== levelsOnBoard.length;
        const addBtn = document.getElementById('add-coins-btn');
        if (state.coins < getSpawnCost() && !hasMergeAvailable && state.storage.length === 0) {
            addBtn.classList.add('emergency-active');
        } else {
            addBtn.classList.remove('emergency-active');
        }
    }

    function renderShop() {
        const list = document.getElementById('shop-list');
        list.innerHTML = '';
        state.discovered.forEach(lvl => {
            const it = ITEM_TYPES[lvl];
            list.innerHTML += `
                <div class="bg-slate-900 border border-slate-800 p-4 rounded-3xl flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <span class="text-4xl">${it.emoji}</span>
                        <div>
                            <p class="font-black text-white text-[11px] uppercase tracking-tight">${it.name}</p>
                            <p class="text-[9px] text-slate-500 font-bold uppercase">–¶–µ–Ω–∞: ${it.buy} ü™ô</p>
                        </div>
                    </div>
                    <div class="flex gap-1.5">
                        <button onclick="buyFromShop(${lvl}, 1)" class="bg-slate-800 hover:bg-slate-700 px-3 py-2 rounded-xl text-[10px] font-black uppercase active:scale-95 transition-all">–ö—É–ø–∏—Ç—å 1</button>
                        <button onclick="buyFromShop(${lvl}, 10)" class="bg-indigo-600 hover:bg-indigo-500 px-3 py-2 rounded-xl text-[10px] font-black uppercase active:scale-95 transition-all">x10</button>
                    </div>
                </div>
            `;
        });
    }

    function showDiscovery(lvl) {
        const d = ITEM_TYPES[lvl];
        document.getElementById('new-emoji').innerText = d.emoji;
        document.getElementById('new-name').innerText = d.name;
        document.getElementById('discovery-modal').classList.remove('hidden');
    }

    function togglePanel(id) {
        document.querySelectorAll('.panel').forEach(p => {
            if (p.id !== 'panel-' + id) p.classList.remove('active');
        });
        const panel = document.getElementById('panel-' + id);
        panel.classList.toggle('active');
        
        if (id === 'storage') renderStorage();
        if (id === 'shop') renderShop();
    }

    function renderStorage() {
        const grid = document.getElementById('storage-grid');
        grid.innerHTML = '';
        for(let i=0; i<16; i++) {
            const lvl = state.storage[i];
            const slot = document.createElement('div');
            slot.className = `h-16 rounded-2xl border-2 border-slate-800 bg-slate-900 flex items-center justify-center text-3xl shadow-inner cursor-pointer active:scale-90 transition-all`;
            if (lvl !== undefined) {
                slot.innerText = ITEM_TYPES[lvl].emoji;
                slot.onclick = () => {
                    state.storage.splice(i, 1);
                    createItem(lvl);
                    renderStorage();
                    togglePanel('storage');
                };
            } else {
                slot.classList.add('opacity-30');
            }
            grid.appendChild(slot);
        }
    }

    function renderBoard() {
        document.querySelectorAll('.item').forEach(e => e.remove());
        state.items.forEach(renderItem);
    }

    function save() { localStorage.setItem('hc_alchemy_absolute_v2', JSON.stringify(state)); }
    window.onload = init;
</script>

</body>
</html>

